<app-navbar></app-navbar>


<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">&times;</span> </button> </div>
            <div class="modal-body p-0 row">
                <div class="col-12 col-lg-5 ad p-0"> <img src="https://cdn.pixabay.com/photo/2021/01/28/14/44/facade-5958189_960_720.jpg" width="100%" height="100%" /> </div>
                <div class="details col-12 col-lg-7">
                    <h2>CREAR ENTORNO</h2>
                    <p><small class="para">Felicidades, estás a unos cuantos pasos <br> de crear tu entorno de trabajo.</small></p>
                    <form [formGroup]="form" (ngSubmit)="onSubmit()">
                        <div class="form-group mt-3 pt-3 mb-5">
                            <p><small class="para">Nombre de la empresa o del entorno de trabajo</small></p>
                            <input type="text" class="form-control" formControlName='name' autocomplete="off" id="formGroupExampleInput2" placeholder="Escriba aquí...">
                            <br>
                            <p><small class="para">Imagen del entorno</small></p>
                            <input type="file"  accept=".png, .jpg"  (change)='onUpload($event)' class="form-control" id="exampleFormControlFile1">
                            <br>
                            <ng-container *ngIf="urlImage | async; else btnDisable">
                                <button type="submit" class="btn btn-primary" >Crear</button>
                            </ng-container>
                            <ng-template #btnDisable>
                                <button type="button" disabled=true class="btn btn-secondary">Crear</button>
                            </ng-template>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="container">
  <div class="row">
      <div class="col-lg-12 card-margin">
          <div class="card search-form">
              <div class="card-body p-0">
                  <form id="search-form" [formGroup]="formSearch" (ngSubmit)='searchEnvironment()'>
                      <div class="row">
                          <div class="col-12">
                              <div class="row no-gutters">
                                  <div class="col-lg-11 col-md-4 col-sm-12 p-0">
                                      <input type="text" placeholder="Buscar por nombre..." class="form-control" formControlName='search' id="search" autocomplete="off" name="search">
                                  </div>
                                  <div class="col-lg-1 col-md-3 col-sm-12 p-0">
                                      <button type="submit" class="btn btn-base">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                      </button>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </form>
              </div>
          </div>
      </div>
  </div>
  <div class="row">
          <div class="col-12">
              <div class="card card-margin">
                  <div class="card-body">
                      <div class="row search-body">
                          <div class="col-lg-12">
                              <div class="search-result">
                                  <div class="result-header">
                                      <div class="row">
                                          <div class="col-lg-4">
                                              <div class="records">
                                              </div>
                                          </div>
                                          <div class="col-lg-5">
                                            <div class="records">
                                              <h4>Entornos de Trabajo</h4>
                                            </div>
                                        </div>
                                          <div class="col-lg-3">
                                            <div class="result-views">
                                                <button type="button" class="btn btn-soft-base btn-icon" (click)="showData()">
                                                    <svg class="svg-icon" viewBox="0 0 20 20">
                                                        <path fill="none" d="M19.305,9.61c-0.235-0.235-0.615-0.235-0.85,0l-1.339,1.339c0.045-0.311,0.073-0.626,0.073-0.949
                                                            c0-3.812-3.09-6.901-6.901-6.901c-2.213,0-4.177,1.045-5.44,2.664l0.897,0.719c1.053-1.356,2.693-2.232,4.543-2.232
                                                            c3.176,0,5.751,2.574,5.751,5.751c0,0.342-0.037,0.675-0.095,1l-1.746-1.39c-0.234-0.235-0.614-0.235-0.849,0
                                                            c-0.235,0.235-0.235,0.615,0,0.85l2.823,2.25c0.122,0.121,0.282,0.177,0.441,0.172c0.159,0.005,0.32-0.051,0.44-0.172l2.25-2.25
                                                            C19.539,10.225,19.539,9.845,19.305,9.61z M10.288,15.752c-3.177,0-5.751-2.575-5.751-5.752c0-0.276,0.025-0.547,0.062-0.813
                                                            l1.203,1.203c0.235,0.234,0.615,0.234,0.85,0c0.234-0.235,0.234-0.615,0-0.85l-2.25-2.25C4.281,7.169,4.121,7.114,3.961,7.118
                                                            C3.802,7.114,3.642,7.169,3.52,7.291l-2.824,2.25c-0.234,0.235-0.234,0.615,0,0.85c0.235,0.234,0.615,0.234,0.85,0l1.957-1.559
                                                            C3.435,9.212,3.386,9.6,3.386,10c0,3.812,3.09,6.901,6.902,6.901c2.083,0,3.946-0.927,5.212-2.387l-0.898-0.719
                                                            C13.547,14.992,12.008,15.752,10.288,15.752z"></path>
                                                    </svg>
                                                </button>
                                                <div class="btn-group">
                                                    <button type="button" class="btn btn-soft-base btn-icon  dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                        <svg
                                                            xmlns="http://www.w3.org/2000/svg"
                                                            width="24"
                                                            height="24"
                                                            viewBox="0 0 24 24"
                                                            fill="none"
                                                            stroke="currentColor"
                                                            stroke-width="2"
                                                            stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                            class="feather feather-list"
                                                        >
                                                            <line x1="8" y1="6" x2="21" y2="6"></line>
                                                            <line x1="8" y1="12" x2="21" y2="12"></line>
                                                            <line x1="8" y1="18" x2="21" y2="18"></line>
                                                            <line x1="3" y1="6" x2="3" y2="6"></line>
                                                            <line x1="3" y1="12" x2="3" y2="12"></line>
                                                            <line x1="3" y1="18" x2="3" y2="18"></line>
                                                        </svg>
                                                    </button>
                                                    <div class="dropdown-menu">
                                                        <a class="dropdown-item" data-toggle="modal" data-target="#exampleModal">Crear Entorno</a>
                                                        <div class="dropdown-divider"></div>
                                                        <a class="dropdown-item" (click)="joinEnvironment()" >Unirse a un entorno</a>
                                                    </div>
                                                </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                                  <div class="result-body">
                                      <div class="table-responsive">
                                        <ng-container *ngIf="data != ''; else elseTemplatess">
                                          <table class="table widget-26">
                                            <tr>
                                              <th scope="col"></th>
                                              <th scope="col">Nombre</th>
                                              <th scope="col">Clave</th>
                                              <th scope="col">Fecha de creación</th>
                                              <th scope="col">Creado por</th>
                                              <th scope="col"></th>
                                              <th scope="col"></th>
                                            </tr>
                                                <tbody>
                                                    <tr *ngFor="let i of data "> 
                                                        <td>
                                                            <div class="widget-26-job-emp-img">
                                                                <img src="{{i.img}}" alt="Company" />
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="widget-26-job-title">
                                                                <a [routerLink]="['/environment',i.id]">{{i.name}}</a>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="widget-26-job-info">
                                                                <p class="type m-0">{{i.key_code}}</p>
                                                                
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="widget-26-job-salary">{{i.creation_date}}</div>
                                                        </td>
                                                        <td>
                                                            <div class="widget-26-job-category bg-soft-base">
                                                                <i class="indicator bg-base"></i>
                                                                <span>@{{i.name_user}}</span>
                                                            </div>
                                                        </td>
                                                        <td *ngIf="i.admin == true">
                                                            <button type="button" class="btn" (click)="toRute(i.id)">
                                                                <svg class="svg-icon" viewBox="0 0 20 20">
                                                                    <path d="M15.573,11.624c0.568-0.478,0.947-1.219,0.947-2.019c0-1.37-1.108-2.569-2.371-2.569s-2.371,1.2-2.371,2.569c0,0.8,0.379,1.542,0.946,2.019c-0.253,0.089-0.496,0.2-0.728,0.332c-0.743-0.898-1.745-1.573-2.891-1.911c0.877-0.61,1.486-1.666,1.486-2.812c0-1.79-1.479-3.359-3.162-3.359S4.269,5.443,4.269,7.233c0,1.146,0.608,2.202,1.486,2.812c-2.454,0.725-4.252,2.998-4.252,5.685c0,0.218,0.178,0.396,0.395,0.396h16.203c0.218,0,0.396-0.178,0.396-0.396C18.497,13.831,17.273,12.216,15.573,11.624 M12.568,9.605c0-0.822,0.689-1.779,1.581-1.779s1.58,0.957,1.58,1.779s-0.688,1.779-1.58,1.779S12.568,10.427,12.568,9.605 M5.06,7.233c0-1.213,1.014-2.569,2.371-2.569c1.358,0,2.371,1.355,2.371,2.569S8.789,9.802,7.431,9.802C6.073,9.802,5.06,8.447,5.06,7.233 M2.309,15.335c0.202-2.649,2.423-4.742,5.122-4.742s4.921,2.093,5.122,4.742H2.309z M13.346,15.335c-0.067-0.997-0.382-1.928-0.882-2.732c0.502-0.271,1.075-0.429,1.686-0.429c1.828,0,3.338,1.385,3.535,3.161H13.346z"></path>
                                                                </svg>
                                                            </button>
                                                            <button type="button" class="btn" >
                                                                <svg class="svg-icon" viewBox="0 0 20 20">
                                                                    <path d="M15.475,6.692l-4.084-4.083C11.32,2.538,11.223,2.5,11.125,2.5h-6c-0.413,0-0.75,0.337-0.75,0.75v13.5c0,0.412,0.337,0.75,0.75,0.75h9.75c0.412,0,0.75-0.338,0.75-0.75V6.94C15.609,6.839,15.554,6.771,15.475,6.692 M11.5,3.779l2.843,2.846H11.5V3.779z M14.875,16.75h-9.75V3.25h5.625V7c0,0.206,0.168,0.375,0.375,0.375h3.75V16.75z"></path>
                                                                </svg>
                                                            </button>
                                                        </td>
                                                        <td *ngIf="i.admin == true">
                                                            <button type="button" class="btn" (click)="removeEnvironment(i.id)">
                                                                <svg class="svg-icon" viewBox="0 0 20 20">
                                                                    <path fill="none" d="M16.471,5.962c-0.365-0.066-0.709,0.176-0.774,0.538l-1.843,10.217H6.096L4.255,6.5c-0.066-0.362-0.42-0.603-0.775-0.538C3.117,6.027,2.876,6.375,2.942,6.737l1.94,10.765c0.058,0.318,0.334,0.549,0.657,0.549h8.872c0.323,0,0.6-0.23,0.656-0.549l1.941-10.765C17.074,6.375,16.833,6.027,16.471,5.962z"></path>
                                                                    <path fill="none" d="M16.594,3.804H3.406c-0.369,0-0.667,0.298-0.667,0.667s0.299,0.667,0.667,0.667h13.188c0.369,0,0.667-0.298,0.667-0.667S16.963,3.804,16.594,3.804z"></path>
                                                                    <path fill="none" d="M9.25,3.284h1.501c0.368,0,0.667-0.298,0.667-0.667c0-0.369-0.299-0.667-0.667-0.667H9.25c-0.369,0-0.667,0.298-0.667,0.667C8.583,2.985,8.882,3.284,9.25,3.284z"></path>
                                                                </svg>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                          </table>
                                        </ng-container>
                                          <ng-template #elseTemplatess>
                                            <table class="table widget-26">
                                                <tr>
                                                  <th scope="col"></th>
                                                  <th scope="col">Nombre</th>
                                                  <th scope="col">Clave</th>
                                                  <th scope="col">Fecha Creación</th>
                                                  <th scope="col">Creado por:</th>
                                                </tr>
                                            </table>
                                            <div  class="alert alert-success" role="alert">
                                                <h4 class="alert-heading">¡ Que bueno verte por aquí !</h4>
                                                <p>Bienvenido a tu tablero de entornos, aquí podrás ver cada uno de los entornos de trabajo que has creado, también podrás ver a los colaboradores que se encuentren ayudándote en tu empresa o editar tu perfil.</p>
                                                <hr>
                                                <p class="mb-0">¡ Qué estás esperando para crear o unirte a tu primer entorno de trabajo !</p>
                                             </div>
                                        </ng-template>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>